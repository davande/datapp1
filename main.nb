{"nbformat_minor":0,"cells":[{"cell_type":"markdown","source":"## Face Count Study","outputs":null,"metadata":{"urth":{"dashboard":{"layout":{"col":0,"height":3,"row":0,"width":12}}}}},{"execution_count":17,"cell_type":"code","source":"from pyspark import SparkFiles\nimport numpy as np\nimport cv2\nimport pickle\nfrom subprocess import call\n\ndef face_counter(an_img_rdd_element):\n    x = an_img_rdd_element[0]\n    img = an_img_rdd_element[1]\n    \n    call('my_c++_exe)')\n    img_fname = x.split(\"/\")[-1]\n    file_bytes = np.asarray(bytearray(img), dtype=np.uint8)\n    im = cv2.imdecode(file_bytes,1)\n    gray = cv2.cvtColor(im, cv2.COLOR_BGR2GRAY)\n    faceCascade = cv2.CascadeClassifier(SparkFiles.get(\"haarcascade_frontalface_default.xml\"))\n    faces = faceCascade.detectMultiScale(im)\n    return Row(face_count=len(faces),file_name=img_fname)\n","outputs":[],"metadata":{"collapsed":false,"trusted":true,"urth":{"dashboard":{}}}},{"execution_count":18,"cell_type":"code","source":"!wget https://raw.githubusercontent.com/shantnu/Webcam-Face-Detect/master/haarcascade_frontalface_default.xml \u003e /dev/null 2\u003e\u00261\nsc.addFile(\"./haarcascade_frontalface_default.xml\")","outputs":[],"metadata":{"collapsed":false,"trusted":true,"urth":{"dashboard":{}}}},{"execution_count":13,"cell_type":"code","source":"result = sc.binaryFiles(\"s3a://ps-samples/imdb/images/2003/01/01/*/\").map(face_counter).toDF()","outputs":[],"metadata":{"collapsed":false,"trusted":true,"urth":{"dashboard":{}}}},{"execution_count":14,"cell_type":"code","source":"result.plot(limit=10)","outputs":[{"data":{"text/html":"\u003cdiv\u003e\n\u003ctable border=\"1\" class=\"dataframe\"\u003e\n  \u003cthead\u003e\n    \u003ctr style=\"text-align: right;\"\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003eface_count\u003c/th\u003e\n      \u003cth\u003efile_name\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003cth\u003e0\u003c/th\u003e\n      \u003ctd\u003e3\u003c/td\u003e\n      \u003ctd\u003eimg_226.jpg\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e1\u003c/th\u003e\n      \u003ctd\u003e3\u003c/td\u003e\n      \u003ctd\u003eimg_230.jpg\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2\u003c/th\u003e\n      \u003ctd\u003e1\u003c/td\u003e\n      \u003ctd\u003eimg_176.jpg\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e3\u003c/th\u003e\n      \u003ctd\u003e1\u003c/td\u003e\n      \u003ctd\u003eimg_588.jpg\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e4\u003c/th\u003e\n      \u003ctd\u003e1\u003c/td\u003e\n      \u003ctd\u003eimg_698.jpg\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e5\u003c/th\u003e\n      \u003ctd\u003e2\u003c/td\u003e\n      \u003ctd\u003eimg_558.jpg\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e6\u003c/th\u003e\n      \u003ctd\u003e4\u003c/td\u003e\n      \u003ctd\u003eimg_534.jpg\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e7\u003c/th\u003e\n      \u003ctd\u003e1\u003c/td\u003e\n      \u003ctd\u003eimg_547.jpg\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e8\u003c/th\u003e\n      \u003ctd\u003e1\u003c/td\u003e\n      \u003ctd\u003eimg_346.jpg\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e9\u003c/th\u003e\n      \u003ctd\u003e1\u003c/td\u003e\n      \u003ctd\u003eimg_136.jpg\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003c/div\u003e","text/plain":"   face_count    file_name\n0           3  img_226.jpg\n1           3  img_230.jpg\n2           1  img_176.jpg\n3           1  img_588.jpg\n4           1  img_698.jpg\n5           2  img_558.jpg\n6           4  img_534.jpg\n7           1  img_547.jpg\n8           1  img_346.jpg\n9           1  img_136.jpg"},"execution_count":14,"metadata":{},"output_type":"execute_result"}],"metadata":{"collapsed":false,"trusted":true,"urth":{"dashboard":{"hidden":true}}}},{"execution_count":15,"cell_type":"code","source":"result.groupBy(\"face_count\").agg(count(\"face_count\").alias(\"total_files\")).sort(desc(\"total_files\")).plot()","outputs":[{"data":{"text/html":"\u003cdiv\u003e\n\u003ctable border=\"1\" class=\"dataframe\"\u003e\n  \u003cthead\u003e\n    \u003ctr style=\"text-align: right;\"\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003eface_count\u003c/th\u003e\n      \u003cth\u003etotal_files\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003cth\u003e0\u003c/th\u003e\n      \u003ctd\u003e1\u003c/td\u003e\n      \u003ctd\u003e15\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e1\u003c/th\u003e\n      \u003ctd\u003e2\u003c/td\u003e\n      \u003ctd\u003e4\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2\u003c/th\u003e\n      \u003ctd\u003e4\u003c/td\u003e\n      \u003ctd\u003e2\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e3\u003c/th\u003e\n      \u003ctd\u003e3\u003c/td\u003e\n      \u003ctd\u003e2\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e4\u003c/th\u003e\n      \u003ctd\u003e0\u003c/td\u003e\n      \u003ctd\u003e1\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003c/div\u003e","text/plain":"   face_count  total_files\n0           1           15\n1           2            4\n2           4            2\n3           3            2\n4           0            1"},"execution_count":15,"metadata":{},"output_type":"execute_result"}],"metadata":{"collapsed":false,"trusted":true,"urth":{"dashboard":{"layout":{"col":10,"height":18,"row":3,"width":2}}}}},{"execution_count":16,"cell_type":"code","source":"result.groupBy(\"face_count\").agg(count(\"face_count\").alias(\"total_files\"))\\\n.sort(desc(\"face_count\"))\\\n.plot(kind=\"bar\",x=\"face_count\", y=[\"total_files\"],xTitle=\"Face Count\",yTitle=\"Number of Files\")","outputs":[{"data":{"text/html":"\u003cdiv class=\"218a3c15-fd52-43e4-9f22-f67afd137ebd cell-loading\" style=\"color: rgb(50,50,50);\"\u003eDrawing...\u003c/div\u003e\u003cdiv id=\"widget-218a3c15-fd52-43e4-9f22-f67afd137ebd\"\u003e\u003c/div\u003e\u003cscript type=\"text/javascript\"\u003eREST.plot(\"218a3c15-fd52-43e4-9f22-f67afd137ebd\", [{\"name\": \"total_files\", \"text\": \"\", \"y\": [2, 2, 4, 15, 1], \"marker\": {\"color\": \"rgba(255, 153, 51, 0.6)\", \"line\": {\"color\": \"rgba(255, 153, 51, 1.0)\", \"width\": 1}}, \"x\": [4, 3, 2, 1, 0], \"type\": \"bar\", \"orientation\": \"v\"}], {\"paper_bgcolor\": \"#FFFFFF\", \"plot_bgcolor\": \"#FFFFFF\", \"xaxis1\": {\"tickfont\": {\"color\": \"#4D5663\"}, \"title\": \"Face Count\", \"showgrid\": true, \"zerolinecolor\": \"#E1E5ED\", \"gridcolor\": \"#E1E5ED\", \"titlefont\": {\"color\": \"#4D5663\"}}, \"yaxis1\": {\"tickfont\": {\"color\": \"#4D5663\"}, \"title\": \"Number of Files\", \"showgrid\": true, \"zerolinecolor\": \"#E1E5ED\", \"gridcolor\": \"#E1E5ED\", \"titlefont\": {\"color\": \"#4D5663\"}}, \"titlefont\": {\"color\": \"#4D5663\"}, \"legend\": {\"bgcolor\": \"#FFFFFF\", \"font\": {\"color\": \"#4D5663\"}}})\u003c/script\u003e","text/plain":"\u003cIPython.core.display.HTML object\u003e"},"metadata":{},"output_type":"display_data"}],"metadata":{"collapsed":false,"trusted":true,"urth":{"dashboard":{"layout":{"col":0,"height":18,"row":3,"width":10}}}}},{"cell_type":"code","source":"","outputs":[],"metadata":{"collapsed":true,"trusted":true,"urth":{"dashboard":{}}}},{"cell_type":"code","source":"","outputs":[],"metadata":{"collapsed":true,"trusted":true,"urth":{"dashboard":{}}}},{"cell_type":"code","source":"","outputs":[],"metadata":{"collapsed":true,"trusted":true,"urth":{"dashboard":{}}}},{"cell_type":"code","source":"def images(path):\n  return sc.binaryFiles(path)","outputs":[],"metadata":{"collapsed":true,"trusted":true,"urth":{"dashboard":{}}}},{"cell_type":"code","source":"","outputs":[],"metadata":{"collapsed":true,"trusted":true,"urth":{"dashboard":{}}}},{"cell_type":"code","source":"","outputs":[],"metadata":{"collapsed":true,"trusted":true,"urth":{"dashboard":{}}}},{"cell_type":"code","source":"","outputs":[],"metadata":{"collapsed":true,"trusted":true,"urth":{"dashboard":{}}}}],"nbformat":4,"metadata":{"kernelspec":{"display_name":"Python 2","name":"python2","language":"python"},"language_info":{"mimetype":"text/x-python","nbconvert_exporter":"python","version":"2.7.12","name":"python","file_extension":".py","pygments_lexer":"ipython2","codemirror_mode":{"version":2,"name":"ipython"}}}}
